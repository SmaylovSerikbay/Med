# Инструкция: Авторизация по паролю

## Что реализовано

Добавлена возможность входа в систему двумя способами:

### 1. WhatsApp OTP (как раньше)
- Быстрый вход через код в WhatsApp
- Не требует запоминания пароля
- Рекомендуется для большинства пользователей

### 2. Пароль (новое)
- Вход по номеру телефона + пароль
- Удобно, если нет доступа к WhatsApp
- Можно установить в настройках профиля

## Для пользователей

### Как установить пароль

1. Войдите в систему через WhatsApp (как обычно)
2. Нажмите на иконку ⚙️ (настройки) в правом верхнем углу
3. Прокрутите до раздела "Установить пароль"
4. Введите новый пароль (минимум 6 символов)
5. Подтвердите пароль
6. Нажмите "Установить пароль"

### Как войти по паролю

1. Откройте страницу входа
2. Переключитесь на вкладку "Пароль"
3. Введите номер телефона
4. Введите пароль
5. Нажмите "Войти"

### Как изменить пароль

1. Откройте настройки (⚙️)
2. В разделе "Изменить пароль":
   - Введите текущий пароль
   - Введите новый пароль
   - Подтвердите новый пароль
3. Нажмите "Изменить пароль"

### Забыли пароль?

1. На странице входа выберите "Пароль"
2. Нажмите "Забыли пароль?"
3. Введите номер телефона
4. Получите код в WhatsApp
5. Введите код
6. Установите новый пароль

## Для разработчиков

### Новые файлы

**Backend:**
- Обновлены: `views.py`, `urls.py`, `serializers.py` в `apps/authentication/`
- Тестовый скрипт: `backend/test_password_auth.py`

**Frontend:**
- Обновлена: `app/login/page.tsx`
- Новая: `app/dashboard/settings/page.tsx`
- Обновлены: `lib/api.ts`, `store/userStore.ts`, `components/layout/Header.tsx`

### API Endpoints

```
POST /api/auth/login-password/          # Вход по паролю
POST /api/auth/set-password/            # Установка/изменение пароля
POST /api/auth/reset-password/request/  # Запрос сброса пароля
POST /api/auth/reset-password/confirm/  # Подтверждение сброса
```

### Тестирование

```bash
# Backend тесты
cd backend
python test_password_auth.py

# Или вручную через curl
curl -X POST http://localhost:8000/api/auth/login-password/ \
  -H "Content-Type: application/json" \
  -d '{"phone_number": "77001234567", "password": "mypassword"}'
```

### Миграции

Не требуются! Поле `password` уже есть в `AbstractUser`.

## Безопасность

✅ Пароли хешируются (Django PBKDF2)  
✅ Минимум 6 символов  
✅ Требуется текущий пароль для изменения  
✅ OTP для сброса пароля (5 минут)  
✅ Одноразовые OTP коды  

## Преимущества

### Для пользователей
- Выбор удобного способа входа
- Резервный способ, если нет доступа к WhatsApp
- Быстрый вход без ожидания SMS

### Для бизнеса
- Снижение зависимости от WhatsApp
- Повышение доступности системы
- Соответствие стандартам безопасности

## Поддержка

Вопросы? Смотрите полную документацию:
- `AUTHENTICATION_GUIDE.md` - подробное руководство
- `QUICK_AUTH_SETUP.md` - быстрый старт

## Скриншоты

### Страница входа
```
┌─────────────────────────────────┐
│  [WhatsApp] [Пароль]  ← вкладки │
│                                 │
│  Номер телефона                 │
│  ┌───────────────────────────┐  │
│  │ 77001234567               │  │
│  └───────────────────────────┘  │
│                                 │
│  Пароль                         │
│  ┌───────────────────────────┐  │
│  │ ••••••••                  │  │
│  └───────────────────────────┘  │
│                                 │
│  [      Войти      ]            │
│                                 │
│  Забыли пароль?                 │
└─────────────────────────────────┘
```

### Настройки профиля
```
┌─────────────────────────────────┐
│  Настройки                      │
│                                 │
│  📱 Информация об аккаунте      │
│  Номер: 77001234567             │
│  Пароль: ✅ Установлен          │
│                                 │
│  🔒 Изменить пароль             │
│  Текущий пароль                 │
│  ┌───────────────────────────┐  │
│  │                           │  │
│  └───────────────────────────┘  │
│  Новый пароль                   │
│  ┌───────────────────────────┐  │
│  │                           │  │
│  └───────────────────────────┘  │
│  Подтвердите пароль             │
│  ┌───────────────────────────┐  │
│  │                           │  │
│  └───────────────────────────┘  │
│                                 │
│  [  Изменить пароль  ]          │
└─────────────────────────────────┘
```

## Статус

✅ Backend реализован  
✅ Frontend реализован  
✅ Тесты написаны  
✅ Документация готова  
🚀 Готово к использованию!
